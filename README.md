# NVIDIA GPU feature discovery

## Table of Contents

- [NVIDIA GPU feature discovery](#nvidia-gpu-feature-discovery)
  * [Overview](#overview)
  * [Alpha Version](#alpha-version)
  * [Requirements](#requirements)
  * [Command line interface](#command-line-interface)
  * [Quick Start](#quick-start)
    + [Node Feature Discovery](#node-feature-discovery)
    + [Preparing your GPU Nodes](#preparing-your-gpu-nodes)
    + [Deploy NVIDIA GPU Feature Discovery](#deploy-nvidia-gpu-feature-discovery)
      - [Deamonset](#deamonset)
      - [Job](#job)
  * [Labels](#labels)
  * [Building from source](#building-from-source)

## Overview

NVIDIA GPU Feature Discovery for Kubernetes is a software that allows you to
automatically generate label depending on the GPU available on the node. It uses
the [Node Feature Discovery](https://github.com/kubernetes-sigs/node-feature-discovery)
from Kubernetes to label nodes.

## Alpha Version

**WARNING:** This tool is in alpha version. We may break the API without notice
between releases.

## Requirements

TODO

## Command line interface

```
gpu-feature-discovery:
Usage:
  gpu-feature-discovery [--oneshot | --sleep-interval=<seconds>]
  gpu-feature-discovery -h | --help
  gpu-feature-discovery --version

Options:
  -h --help                   Show this help message and exit
  --version                   Display version and exit
  --oneshot                   Label once and exit
  --sleep-interval=<seconds>  Time to sleep between labeling [Default: 60s]
```

## Quick Start

### Node Feature Discovery

The first step is to make sure the [Node Feature Discovery](https://github.com/kubernetes-sigs/node-feature-discovery)
is running on every node you want to label. NVIDIA GPU Feature Discovery use
the `local` source so be sure to mount volumes. See
https://github.com/kubernetes-sigs/node-feature-discovery for more details.

### Preparing your GPU Nodes

Be sure that [nvidia-docker2](https://github.com/NVIDIA/nvidia-docker) is
installed on your GPU nodes and Docker default runtime is set to `nvidia`. See
https://github.com/NVIDIA/nvidia-docker/wiki/Advanced-topics#default-runtime.

### Deploy NVIDIA GPU Feature Discovery

The next step is to run NVIDIA GPU Feature Discovery on each node as a Deamonset
or as a Job.

#### Deamonset

```shell
$ kubectl apply -f ${YAML_DAEMONSET}
```

#### Job

```shell
$ kubectl apply -f ${YAML_JOB}
```

## Labels

This is the list of the labels generated by NVIDIA GPU Feature Discovery and
their meaning:

| Label Name            | Value Type | Meaning                      | Example        |
| --------------------- | ---------- | ---------------------------- | -------------- |
| nvidia-driver-version | String     | Version of the NVIDIA driver | 418.56         |
| nvidia-model          | String     | Model of the GPU             | GeForce-GT-710 |
| nvidia-memory         | Interger   | Memory of the GPU in Mb      | 2000           |

## Building from source

Download the source code:
```shell
git clone ${GIT_URL}
```

Get dependies:
```shell
dep ensure
```

Build it:
```
go build
```
